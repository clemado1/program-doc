<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/doc_common :: docHead"><title></title></head>
<body>
<div th:replace="fragments/doc_common :: docBody"></div>
    <input id="docId" name="docId" th:value="${docId}" type="hidden"/>
    <input id="docSn" name="docSn" th:value="${docSn}" type="hidden"/>
    <input id="programCd" name="programCd" th:value="${programCd}" type="hidden"/>
    <h1>writeform</h1>
    <input id="title" name="title" placeholder="title" type="text"/>
    version: <input id="version" name="version" step="0.01" type="number" value="1.00"/>
    <div id="editor"></div>
    <script>
        const Editor = toastui.Editor;
        const codeSyntaxHighlight = Editor.plugin.codeSyntaxHighlight;
        const editor = new Editor({
            el: document.querySelector('#editor'),
            height: '600px',
            initialEditType: 'markdown',
            previewStyle: 'vertical',
            plugins: [codeSyntaxHighlight]
        });

        editor.getHtml();
    </script>
    <button id="form-submit" th:text="Save" type="submit"></button>
<script>
    const saveBtn = document.querySelector("#form-submit");
    saveBtn.addEventListener('click', function () {
        const docId = document.getElementById("docId").value;
        const saveUrl = isNaN(docId) ? "/api/doc/create" : "/api/doc/save";
        console.log(saveUrl);

        fetch(saveUrl, {
            method: 'post',
            headers: {
                'content-type': 'application/json',
                'Authorization': 'Bearer ' + localStorage.getItem("jwt"),
            },
            body : JSON.stringify({
                docId : document.getElementById("docId").value,
                docSn : document.getElementById("docSn").value,
                programCd : document.getElementById("programCd").value,
                title : document.getElementById("title").value,
                version : document.getElementById("version").value,
                contents : editor.getMarkdown(),
            })
        }).then(res => {
            console.log(res);
            return res.json();
        })
            .then(docId => {
                location.href = `/doc/view/${docId}`;
            });
    });
</script>
</body>
</html>