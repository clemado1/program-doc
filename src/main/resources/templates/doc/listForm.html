<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>List</title>
</head>
<script>
    fetch("/api/prg/list",{
        method: 'get',
        headers: {
            'content-type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem("jwt"),
        }
    }).then(res => res.json())
        .then(json => {
            console.log(json);
            let programs = document.getElementById("program-list");
            json.forEach(function (data) {
                let proLi = document.createElement("li");
                proLi.innerText = `[${data.programCd}] ${data.programNm}`;
                if (data.documents.length !== 0) {
                    let docUl = document.createElement("ul");
                    data.documents.forEach(function (doc) {
                        let docLi = document.createElement("li");
                        let docLink = document.createElement("a");
                        docLink.innerText = doc.title;
                        docLink.setAttribute("href", `/doc/view/${doc.docId}`);
                        docLi.appendChild(docLink);
                        docUl.appendChild(docLi);
                    });
                    proLi.appendChild(docUl);
                }
                programs.appendChild(proLi);
            })
        })
</script>
<body>
<div class="container">
    <div id="new-program">
        <input type="text" id="programCd" name="programCd">
        <input type="text" id="programNm" name="programNm">
        <input type="text" id="programType" name="programType">
        <button id="form-submit" th:text="Create" type="submit"></button>
    </div>
    <ul id="program-list">
    </ul>
</div>
<script>
    const saveBtn = document.querySelector("#form-submit");
    saveBtn.addEventListener('click', function () {
        fetch("/api/prg/create", {
            method: 'post',
            headers: {
                'content-type': 'application/json',
                'Authorization': 'Bearer ' + localStorage.getItem("jwt"),
            },
            body : JSON.stringify({
                programCd : document.getElementById("programCd").value,
                programNm : document.getElementById("programNm").value,
                programType : document.getElementById("programType").value,
            })
        }).then(res => res.json())
            .then(program => {
                console.log(program);
                location.href = `/doc/write?programCd=${program.programCd}`;
            });
    });
</script>
</body>
</html>